{"ast":null,"code":"import axios from 'axios';\n\nvar _require = require('../store'),\n    history = _require.history;\n\nvar bitcoin = require(\"bitcoinjs-lib\");\n\nvar buffer = require('buffer');\n\nvar API_URL = \"http://localhost:5000/api\";\nvar BLOCKCRYPHER_URL = \"https://api.blockcypher.com/v1/btc/test3\";\nvar TOKEN = \"?token=\" + \"d340ecf46fa742c19f52e4c7bf1f2408\";\nexport function searchContentsChange(searchInput) {\n  return function (dispatch) {\n    dispatch({\n      type: 'SEARCH_Contents_CHANGE',\n      searchContents: searchInput\n    });\n  };\n}\nexport function searchAddress(address) {\n  console.log('Searching an address');\n  return function (dispatch) {\n    console.log(\"\".concat(BLOCKCRYPHER_URL, \"/addrs/\") + address);\n    axios.get(\"\".concat(BLOCKCRYPHER_URL, \"/addrs/\") + address).then(function (res) {\n      console.log(res);\n      var addressDetail = res.data;\n      dispatch({\n        type: 'LOAD_ADDRESS_DETAIL',\n        addressDetail: addressDetail\n      });\n      history.push('/address');\n    }).catch(function (err) {\n      console.log(err);\n    });\n  };\n} // get the details of a transaction based on its hash\n\nexport function searchTransaction(transaction) {\n  return function (dispatch) {\n    console.log('Searching a transaction'); //console.log(`${BLOCKCRYPHER_URL}/txs/` + transaction);\n\n    axios.get(\"\".concat(BLOCKCRYPHER_URL, \"/txs/\") + transaction).then(function (res) {\n      console.log(res);\n      var transactionDetail = res.data;\n      dispatch({\n        type: 'LOAD_TRANSACTION_DETAIL',\n        transactionDetail: transactionDetail\n      });\n      history.push('/transaction');\n    }).catch(function (err) {\n      console.log(err);\n    });\n  };\n}\nexport function pay(payment) {\n  return function (dispatch) {\n    console.log('Creating a transaction');\n    console.log(payment);\n    var key = bitcoin.ECPair.fromWIF(payment.payerPrivateKeyInput, bitcoin.networks.testnet);\n    var transaction; // 1. Post our simple transaction information to get back the fully built transaction,\n    //    includes fees when required.\n\n    function newTransaction() {\n      var newtx = {\n        \"inputs\": [{\n          \"addresses\": [payment.payerAddressInput]\n        }],\n        \"outputs\": [{\n          \"addresses\": [payment.payeeAddressInput],\n          \"value\": parseInt(payment.payingAmountInput)\n        }]\n      };\n      console.log(newtx);\n      return axios.post(BLOCKCRYPHER_URL + '/txs/new', JSON.stringify(newtx));\n    } // 2. Sign the hexadecimal strings returned with the fully built transaction and include\n    //    the source public address.\n\n\n    function signAndSend(newtx) {\n      newtx = newtx.data;\n      if (checkError(newtx)) return;\n      newtx.pubkeys = [];\n      newtx.signatures = newtx.tosign.map(function (tosign) {\n        newtx.pubkeys.push(payment.payerPublicKeyInput);\n        var signWithHashType = bitcoin.script.signature.encode(key.sign(new buffer.Buffer(tosign, \"hex\")), bitcoin.Transaction.SIGHASH_NONE).toString(\"hex\");\n        console.log(signWithHashType);\n        return signWithHashType.substring(0, signWithHashType.length - 2);\n      });\n      return axios.post(BLOCKCRYPHER_URL + \"/txs/send\", JSON.stringify(newtx)).catch(function (error) {\n        return console.log(error.response.data.errors);\n      });\n    } // 3. Open a websocket to wait for confirmation the transaction has been accepted in a block.\n\n\n    function waitForConfirmation(finaltx) {\n      console.log(finaltx);\n      finaltx = finaltx.data;\n      if (checkError(finaltx)) return;\n      transaction = Object.assign(transaction, finaltx.tx.hash);\n      alert(\"Transaction \" + finaltx.tx.hash + \" to \" + payment.payeeAddressInput + \" of \" + finaltx.tx.outputs[0].value / 100000000 + \" BTC sent.\");\n      alert(\"Waiting for confirmation... (may take > 10 min)\");\n    }\n\n    function checkError(msg) {\n      if (msg.errors && msg.errors.length) {\n        console.log(\"Errors occured!!/n\" + msg.errors.join(\"/n\"));\n        return true;\n      }\n    }\n\n    newTransaction().then(signAndSend).catch(function (error) {\n      return console.log(error);\n    }).then(waitForConfirmation).catch(function (error) {\n      return console.log(error);\n    });\n    axios.get(\"\".concat(BLOCKCRYPHER_URL, \"/txs/\") + transaction).then(function (res) {\n      console.log(res);\n      var transactionDetail = res.data;\n      dispatch({\n        type: 'LOAD_TRANSACTION_DETAIL',\n        transactionDetail: transactionDetail\n      });\n      history.push('/transaction');\n    }).catch(function (err) {\n      console.log(err);\n    });\n  };\n}\nexport function login(username, password) {\n  return function (dispatch) {\n    console.log('Loging in...');\n    axios({\n      url: API_URL + \"/user/login\",\n      method: \"post\",\n      data: JSON.stringify({\n        user: {\n          \"username\": username,\n          \"password\": password\n        }\n      }),\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(function (res) {\n      var user = res.data.user;\n\n      if (!user) {\n        alert(\"Sorry, your username and/or password are wrong! Please check again.\");\n      } else {\n        console.log(user);\n        localStorage.setItem(\"auth\", JSON.stringify(user));\n        dispatch({\n          type: 'LOG_IN',\n          user: user\n        });\n      }\n    }).catch(function (err) {\n      return console.log(err);\n    });\n  };\n}\nexport function signup(username, password) {\n  return function (dispatch) {\n    console.log('Signing up...');\n    axios({\n      url: API_URL + \"/user/signup\",\n      method: \"post\",\n      data: JSON.stringify({\n        user: {\n          \"username\": username,\n          \"password\": password\n        }\n      }),\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(function (res) {\n      var user = res.data.user;\n\n      if (!user) {\n        alert(\"Sorry, your username and/or password are wrong! Please check again.\");\n      } else {\n        localStorage.setItem(\"auth\", JSON.stringify(user));\n        dispatch({\n          type: 'LOG_IN',\n          user: user\n        });\n        history.push('/');\n      }\n    }).catch(function (err) {\n      return console.log(err);\n    });\n  };\n}\nexport function logout() {\n  return function (dispatch) {\n    console.log('Loging out...');\n    dispatch({\n      type: 'LOG_OUT'\n    });\n    history.push('/');\n  };\n}\nexport function choosePayer(index) {\n  console.log(\"Choosing wallet \" + index + \"as payer...\");\n  return function (dispatch) {\n    dispatch({\n      type: 'CHOOSE_PAYER',\n      index: index\n    });\n    history.push('/pay');\n  };\n}\nexport function deleteWallet(walletId) {\n  return function (dispatch) {\n    console.log(\"Deleting wallet \" + walletId + \"...\");\n    axios({\n      url: API_URL + \"/wallet/\" + walletId,\n      method: \"delete\"\n    }).then(function (res) {\n      var error = res.data.err;\n\n      if (!!error) {\n        console.log(error);\n      } else {\n        dispatch({\n          type: 'DELETE_WALLET',\n          walletId: walletId\n        });\n        history.push('/wallet');\n      }\n    }).catch(function (err) {\n      return console.log(err);\n    });\n  };\n}\nexport function addWallet(wallet) {\n  return function (dispatch) {\n    console.log(\"Adding a wallet...\");\n    axios({\n      url: API_URL + \"/wallet\",\n      method: \"post\",\n      data: JSON.stringify({\n        wallet: wallet\n      }),\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(function (res) {\n      var error = res.data.err;\n\n      if (!!error) {\n        console.log(error);\n      } else {\n        var _wallet = res.data.wallet;\n        dispatch({\n          type: 'ADD_WALLET',\n          wallet: _wallet\n        });\n        history.push('/wallet');\n      }\n    }).catch(function (err) {\n      return console.log(err);\n    });\n  };\n}\nexport function backToIndex() {\n  return function (dispatch) {\n    history.push(\"/\");\n  };\n}\nexport function toggleCloseSignin() {\n  return function (dispatch) {\n    dispatch({\n      type: 'TOGGLE_MODAL_SIGNIN',\n      modalModeSignin: false\n    });\n  };\n}\nexport function toggleOpenSignin() {\n  return function (dispatch) {\n    dispatch({\n      type: 'TOGGLE_MODAL_SIGNIN',\n      modalModeSignin: true\n    });\n  };\n}\nexport function toggleCloseSignup() {\n  return function (dispatch) {\n    dispatch({\n      type: 'TOGGLE_MODAL_SIGNUP',\n      modalModeSignup: false\n    });\n  };\n}\nexport function toggleOpenSignup() {\n  return function (dispatch) {\n    dispatch({\n      type: 'TOGGLE_MODAL_SIGNUP',\n      modalModeSignup: true\n    });\n  };\n}","map":{"version":3,"sources":["D:\\Projects\\playground\\playground-bitcoin-blockcrypher\\client\\src\\redux\\actions\\actions.js"],"names":["axios","require","history","bitcoin","buffer","API_URL","BLOCKCRYPHER_URL","TOKEN","searchContentsChange","searchInput","dispatch","type","searchContents","searchAddress","address","console","log","get","then","res","addressDetail","data","push","catch","err","searchTransaction","transaction","transactionDetail","pay","payment","key","ECPair","fromWIF","payerPrivateKeyInput","networks","testnet","newTransaction","newtx","payerAddressInput","payeeAddressInput","parseInt","payingAmountInput","post","JSON","stringify","signAndSend","checkError","pubkeys","signatures","tosign","map","payerPublicKeyInput","signWithHashType","script","signature","encode","sign","Buffer","Transaction","SIGHASH_NONE","toString","substring","length","error","response","errors","waitForConfirmation","finaltx","Object","assign","tx","hash","alert","outputs","value","msg","join","login","username","password","url","method","user","headers","Accept","localStorage","setItem","signup","logout","choosePayer","index","deleteWallet","walletId","addWallet","wallet","_wallet","backToIndex","toggleCloseSignin","modalModeSignin","toggleOpenSignin","toggleCloseSignup","modalModeSignup","toggleOpenSignup"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nconst { history } = require('../store');\r\nconst bitcoin = require(\"bitcoinjs-lib\");\r\nconst buffer  = require('buffer');\r\n\r\nconst API_URL = \"http://localhost:5000/api\";\r\nconst BLOCKCRYPHER_URL = \"https://api.blockcypher.com/v1/btc/test3\";\r\nconst TOKEN = \"?token=\" + \"d340ecf46fa742c19f52e4c7bf1f2408\";\r\n\r\nexport function searchContentsChange(searchInput) {\r\n    return (dispatch) => {\r\n        dispatch({type: 'SEARCH_Contents_CHANGE', searchContents: searchInput})\r\n    }\r\n}\r\n\r\nexport function searchAddress(address){\r\n  console.log('Searching an address');\r\n  return (dispatch) => {\r\n    console.log(`${BLOCKCRYPHER_URL}/addrs/` + address);\r\n    axios.get(`${BLOCKCRYPHER_URL}/addrs/` + address)\r\n    .then((res) => {\r\n      console.log(res);\r\n      let addressDetail = res.data;\r\n      dispatch({type:'LOAD_ADDRESS_DETAIL', addressDetail: addressDetail});\r\n      history.push('/address');\r\n    }).catch((err) => {\r\n      console.log(err);\r\n    });\r\n  }\r\n}\r\n\r\n// get the details of a transaction based on its hash\r\nexport function searchTransaction(transaction){\r\n  return (dispatch) => {\r\n    console.log('Searching a transaction');\r\n    //console.log(`${BLOCKCRYPHER_URL}/txs/` + transaction);\r\n    axios.get(`${BLOCKCRYPHER_URL}/txs/` + transaction)\r\n    .then((res) => {\r\n      console.log(res);\r\n      let transactionDetail = res.data;\r\n      dispatch({type:'LOAD_TRANSACTION_DETAIL', transactionDetail: transactionDetail});\r\n      history.push('/transaction');\r\n    }).catch((err) => {\r\n      console.log(err);\r\n    });\r\n  }\r\n}\r\n\r\nexport function pay(payment){\r\n  return (dispatch) => {\r\n    console.log('Creating a transaction');\r\n    console.log(payment);\r\n    let key   = bitcoin.ECPair.fromWIF(payment.payerPrivateKeyInput, bitcoin.networks.testnet);\r\n    let transaction;\r\n\r\n    // 1. Post our simple transaction information to get back the fully built transaction,\r\n    //    includes fees when required.\r\n    function newTransaction() {\r\n      let newtx = {\r\n        \"inputs\": [{\"addresses\": [payment.payerAddressInput]}],\r\n        \"outputs\": [{\"addresses\": [payment.payeeAddressInput], \"value\": parseInt(payment.payingAmountInput)}],\r\n      }\r\n      console.log(newtx);\r\n      return axios.post(BLOCKCRYPHER_URL + '/txs/new', JSON.stringify(newtx));\r\n    }\r\n\r\n    // 2. Sign the hexadecimal strings returned with the fully built transaction and include\r\n    //    the source public address.\r\n    function signAndSend(newtx) {\r\n    \tnewtx = newtx.data;\r\n      if (checkError(newtx)) return;\r\n      newtx.pubkeys     = [];\r\n      newtx.signatures  = newtx.tosign.map(function(tosign) {\r\n        newtx.pubkeys.push(payment.payerPublicKeyInput);\r\n        let signWithHashType = bitcoin.script.signature.encode(key.sign(new buffer.Buffer(tosign, \"hex\")),  bitcoin.Transaction.SIGHASH_NONE).toString(\"hex\");\r\n        console.log(signWithHashType);\r\n        return signWithHashType.substring(0, signWithHashType.length - 2);\r\n      });\r\n      return axios.post(BLOCKCRYPHER_URL + \"/txs/send\", JSON.stringify(newtx)).catch(error => console.log(error.response.data.errors));\r\n    }\r\n\r\n    // 3. Open a websocket to wait for confirmation the transaction has been accepted in a block.\r\n    function waitForConfirmation(finaltx) {\r\n      console.log(finaltx);\r\n      finaltx = finaltx.data;\r\n      if (checkError(finaltx)) return;\r\n      transaction = Object.assign(transaction, finaltx.tx.hash);\r\n      alert(\"Transaction \" + finaltx.tx.hash + \" to \" + payment.payeeAddressInput + \" of \" +\r\n            finaltx.tx.outputs[0].value/100000000 + \" BTC sent.\");\r\n      alert(\"Waiting for confirmation... (may take > 10 min)\");\r\n    }\r\n\r\n    function checkError(msg) {\r\n      if (msg.errors && msg.errors.length) {\r\n        console.log(\"Errors occured!!/n\" + msg.errors.join(\"/n\"));\r\n        return true;\r\n      }\r\n    }\r\n\r\n    newTransaction()\r\n    .then(signAndSend).catch(error => console.log(error))\r\n    .then(waitForConfirmation).catch(error => console.log(error));\r\n\r\n    axios.get(`${BLOCKCRYPHER_URL}/txs/` + transaction)\r\n    .then((res) => {\r\n      console.log(res);\r\n      let transactionDetail = res.data;\r\n      dispatch({type:'LOAD_TRANSACTION_DETAIL', transactionDetail: transactionDetail});\r\n      history.push('/transaction');\r\n    }).catch((err) => {\r\n      console.log(err);\r\n    });\r\n  }\r\n}\r\n\r\nexport function login(username, password){\r\n  return (dispatch) => {\r\n    console.log('Loging in...');\r\n    axios({\r\n      url: API_URL + \"/user/login\",\r\n      method: \"post\",\r\n      data: JSON.stringify({\r\n        user:{\r\n          \"username\" : username,\r\n          \"password\" : password\r\n        }\r\n      }),\r\n      headers : {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\"\r\n      }\r\n    }).then((res) => {\r\n      let user = res.data.user;\r\n      if (!user) {\r\n        alert(\"Sorry, your username and/or password are wrong! Please check again.\");\r\n      } else {\r\n        console.log(user);\r\n        localStorage.setItem(\"auth\", JSON.stringify(user));\r\n        dispatch({type: 'LOG_IN', user: user});\r\n      }\r\n    }).catch((err)=>console.log(err));\r\n  }\r\n}\r\n\r\nexport function signup(username, password){\r\n  return (dispatch) => {\r\n    console.log('Signing up...');\r\n    axios({\r\n      url: API_URL + \"/user/signup\",\r\n      method: \"post\",\r\n      data: JSON.stringify({\r\n        user:{\r\n          \"username\" : username,\r\n          \"password\" : password\r\n        }\r\n      }),\r\n      headers : {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\"\r\n      }\r\n    }).then((res) => {\r\n      let user = res.data.user;\r\n      if (!user) {\r\n        alert(\"Sorry, your username and/or password are wrong! Please check again.\");\r\n      } else {\r\n        localStorage.setItem(\"auth\", JSON.stringify(user));\r\n        dispatch({type: 'LOG_IN', user});\r\n        history.push('/');\r\n      }\r\n    }).catch((err)=>console.log(err));\r\n  }\r\n}\r\n\r\nexport function logout(){\r\n  return (dispatch) => {\r\n    console.log('Loging out...');\r\n    dispatch({type: 'LOG_OUT'});\r\n    history.push('/');\r\n  }\r\n}\r\n\r\nexport function choosePayer(index){\r\n  console.log(\"Choosing wallet \" + index + \"as payer...\");\r\n  return (dispatch) => {\r\n    dispatch({type: 'CHOOSE_PAYER', index: index});\r\n    history.push('/pay');\r\n  }\r\n}\r\n\r\nexport function deleteWallet(walletId){\r\n  return (dispatch) => {\r\n    console.log(\"Deleting wallet \" + walletId + \"...\");\r\n    axios({\r\n      url: API_URL + \"/wallet/\" + walletId,\r\n      method: \"delete\",\r\n    }).then((res) => {\r\n      let error = res.data.err;\r\n      if (!!error) {\r\n        console.log(error);\r\n      } else {\r\n        dispatch({type: 'DELETE_WALLET', walletId: walletId});\r\n        history.push('/wallet');\r\n      }\r\n    }).catch((err)=>console.log(err));\r\n  }\r\n}\r\n\r\nexport function addWallet(wallet){\r\n  return (dispatch) => {\r\n    console.log(\"Adding a wallet...\");\r\n    axios({\r\n      url: API_URL + \"/wallet\",\r\n      method: \"post\",\r\n      data: JSON.stringify({\r\n        wallet: wallet\r\n      }),\r\n      headers : {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\"\r\n      }\r\n    }).then((res) => {\r\n      let error = res.data.err;\r\n      if (!!error) {\r\n        console.log(error);\r\n      } else {\r\n        let _wallet = res.data.wallet;\r\n        dispatch({type: 'ADD_WALLET', wallet: _wallet});\r\n        history.push('/wallet');\r\n      }\r\n    }).catch((err)=>console.log(err));\r\n  }\r\n}\r\n\r\nexport function backToIndex() {\r\n    return (dispatch) => {\r\n        history.push(\"/\");\r\n    }\r\n}\r\n\r\nexport function toggleCloseSignin() {\r\n    return (dispatch) => {\r\n        dispatch({type: 'TOGGLE_MODAL_SIGNIN', modalModeSignin: false})\r\n    }\r\n}\r\n\r\nexport function toggleOpenSignin() {\r\n    return (dispatch) => {\r\n        dispatch({type: 'TOGGLE_MODAL_SIGNIN', modalModeSignin: true})\r\n    }\r\n}\r\n\r\nexport function toggleCloseSignup() {\r\n    return (dispatch) => {\r\n        dispatch({type: 'TOGGLE_MODAL_SIGNUP', modalModeSignup: false})\r\n    }\r\n}\r\n\r\nexport function toggleOpenSignup() {\r\n    return (dispatch) => {\r\n        dispatch({type: 'TOGGLE_MODAL_SIGNUP', modalModeSignup: true})\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}